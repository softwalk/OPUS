# Agent Contract - SaaS Factory AI Layer
version: "1.0.0"

model_routing:
  default: "claude-sonnet-4-5-20250929"
  routes:
    - name: discovery
      model: "claude-sonnet-4-5-20250929"
      use: "Conversación de discovery, clasificación de intent, construcción de MVS"
      temperature: 0.4
      max_tokens: 4096

    - name: architecture
      model: "claude-opus-4-6"
      use: "Generación de PRD, diseño de DB schema, design document"
      temperature: 0.2
      max_tokens: 16384

    - name: codegen
      model: "claude-sonnet-4-5-20250929"
      use: "Generación de código (API routes, UI components, Prisma schema)"
      temperature: 0.1
      max_tokens: 8192

    - name: review
      model: "claude-opus-4-6"
      use: "Revisión de calidad, compliance check, detección de bugs"
      temperature: 0.0
      max_tokens: 4096

    - name: classification
      model: "claude-haiku-4-5-20251001"
      use: "Clasificación de blueprint, detección de contradicciones, validación simple"
      temperature: 0.0
      max_tokens: 1024

agents:
  orchestrator:
    role: "Coordina el pipeline completo de generación"
    model_route: architecture
    prompt: "prompts/v1/system-orchestrator.md"

  discovery:
    role: "Guía al usuario en el flujo de preguntas mínimas"
    model_route: discovery
    prompt: "prompts/v1/system-discovery.md"

  architect:
    role: "Genera PRD y diseño técnico desde MVS"
    model_route: architecture
    prompt: "prompts/v1/system-architect.md"

  codegen:
    role: "Genera código a partir del design document"
    model_route: codegen
    prompt: "prompts/v1/system-codegen.md"
    parallelizable: true
    modules:
      - database_schema
      - api_routes
      - frontend_pages
      - auth_config
      - billing_integration
      - seed_data

  reviewer:
    role: "Revisa código generado contra PRD y seguridad"
    model_route: review
    prompt: "prompts/v1/system-reviewer.md"

execution_policies:
  max_generation_time_seconds: 600
  max_retries_per_stage: 3
  max_tokens_per_generation: 200000
  max_cost_per_generation_usd: 5.00
  parallel_codegen_workers: 4

cost_optimization:
  prompt_caching: true
  batch_codegen: true
  cache_blueprints: true
  cache_ttl_seconds: 3600
