{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Minimum Viable Spec (MVS)",
  "description": "Schema para validar el input mínimo necesario para generar un SaaS",
  "type": "object",
  "required": ["app_name", "blueprint", "industry", "description", "entities", "roles"],
  "properties": {
    "app_name": {
      "type": "string",
      "minLength": 2,
      "maxLength": 50,
      "pattern": "^[a-zA-ZÀ-ÿ0-9 _-]+$",
      "description": "Nombre de la aplicación"
    },
    "blueprint": {
      "type": "string",
      "enum": ["crm", "inventory", "booking", "lms", "marketplace", "invoicing", "tickets", "projects", "ehr", "pms", "custom"],
      "description": "Tipo base de SaaS"
    },
    "industry": {
      "type": "string",
      "enum": ["healthcare", "retail", "education", "real_estate", "hospitality", "finance", "logistics", "legal", "manufacturing", "general"],
      "description": "Sector / industria"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500
    },
    "locale": {
      "type": "string",
      "default": "es-MX",
      "enum": ["es-MX", "es-ES", "en-US", "pt-BR"]
    },
    "currency": {
      "type": "string",
      "default": "MXN",
      "enum": ["MXN", "USD", "EUR", "BRL", "COP", "ARS"]
    },
    "roles": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "type": "object",
        "required": ["name", "display_name"],
        "properties": {
          "name": { "type": "string", "pattern": "^[a-z_]+$" },
          "display_name": { "type": "string" },
          "description": { "type": "string" }
        }
      }
    },
    "entities": {
      "type": "array",
      "minItems": 1,
      "maxItems": 50,
      "items": {
        "$ref": "#/$defs/Entity"
      }
    },
    "billing_enabled": { "type": "boolean", "default": true },
    "billing_provider": { "type": "string", "default": "stripe", "enum": ["stripe", "mercadopago"] },
    "auth_providers": {
      "type": "array",
      "default": ["email", "google"],
      "items": { "type": "string", "enum": ["email", "google", "github", "microsoft"] }
    },
    "notifications": {
      "type": "array",
      "default": ["email", "in_app"],
      "items": { "type": "string", "enum": ["email", "in_app", "sms", "whatsapp"] }
    },
    "compliance": {
      "type": "array",
      "default": [],
      "items": { "type": "string", "enum": ["lfpdppp", "gdpr", "hipaa", "soc2", "pci_dss"] }
    },
    "integrations": {
      "type": "array",
      "default": [],
      "items": {
        "type": "object",
        "required": ["name", "type"],
        "properties": {
          "name": { "type": "string" },
          "type": { "type": "string", "enum": ["api", "webhook", "oauth", "zapier"] },
          "config": { "type": "object" }
        }
      }
    },
    "branding": {
      "type": "object",
      "default": {},
      "properties": {
        "primary_color": { "type": "string", "pattern": "^#[0-9A-Fa-f]{6}$", "default": "#2563EB" },
        "logo_url": { "type": "string", "format": "uri" }
      }
    },
    "workflows": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["entity", "field", "states", "transitions"],
        "properties": {
          "entity": { "type": "string" },
          "field": { "type": "string" },
          "states": { "type": "array", "items": { "type": "string" } },
          "transitions": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["from", "to"],
              "properties": {
                "from": { "type": "string" },
                "to": { "type": "string" },
                "allowed_roles": { "type": "array", "items": { "type": "string" } },
                "trigger_action": { "type": "string" }
              }
            }
          }
        }
      }
    }
  },
  "$defs": {
    "Entity": {
      "type": "object",
      "required": ["name", "display_name", "fields"],
      "properties": {
        "name": { "type": "string", "pattern": "^[A-Z][a-zA-Z]+$" },
        "display_name": { "type": "string" },
        "fields": {
          "type": "array",
          "minItems": 1,
          "maxItems": 50,
          "items": { "$ref": "#/$defs/Field" }
        },
        "relations": {
          "type": "array",
          "items": { "$ref": "#/$defs/Relation" }
        },
        "permissions": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string", "enum": ["create", "read", "update", "delete"] }
          }
        }
      }
    },
    "Field": {
      "type": "object",
      "required": ["name", "type", "display_name"],
      "properties": {
        "name": { "type": "string", "pattern": "^[a-z][a-z_0-9]+$" },
        "type": { "type": "string", "enum": ["string", "text", "integer", "decimal", "boolean", "date", "datetime", "email", "phone", "url", "enum", "file", "image", "money", "json", "relation"] },
        "display_name": { "type": "string" },
        "required": { "type": "boolean", "default": false },
        "unique": { "type": "boolean", "default": false },
        "options": { "type": "array", "items": { "type": "string" } },
        "default_value": {},
        "min": { "type": "number" },
        "max": { "type": "number" },
        "max_length": { "type": "integer" }
      }
    },
    "Relation": {
      "type": "object",
      "required": ["entity", "type"],
      "properties": {
        "entity": { "type": "string" },
        "type": { "type": "string", "enum": ["one_to_one", "one_to_many", "many_to_one", "many_to_many"] },
        "display_name": { "type": "string" }
      }
    }
  }
}
